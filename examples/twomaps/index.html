<html>
<head>
<title>Modest Maps JS</title>
<script type="text/javascript" src="../../modestmaps.js"></script>
<script type="text/javascript">

var leftMap, rightMap;

function initMaps() {

    var container = document.getElementById('container');
    
    leftMap = new com.modestmaps.Map('leftMap', 
                                     new com.modestmaps.TemplatedMapProvider("http://tile.openstreetmap.org/{Z}/{X}/{Y}.png"), 
                                     new com.modestmaps.Point(container.offsetWidth/2, container.offsetHeight))
    rightMap = new com.modestmaps.Map('rightMap', 
                                      new com.modestmaps.TemplatedMapProvider("http://s3.amazonaws.com/com.modestmaps.bluemarble/{Z}-r{Y}-c{X}.jpg"), 
                                      new com.modestmaps.Point(container.offsetWidth/2, container.offsetHeight))
     
    leftMap.parent.style.position = 'absolute';
    leftMap.parent.style.left = '0px';
    leftMap.parent.style.top = '0px';
    rightMap.parent.style.position = 'absolute';
    rightMap.parent.style.left = parseInt(container.offsetWidth/2) + 'px';
    rightMap.parent.style.top = '0px';

    leftMap.setCenterZoom(new com.modestmaps.Location(0, 0), 2);
    rightMap.setCenterZoom(new com.modestmaps.Location(0, 0), 2);

    var leftChanging = false, rightChanging = false;
    function syncMaps() {
      if (leftChanging) {
        rightMap.setCenterZoom(leftMap.getCenter(), leftMap.getZoom());
      }
      if (rightChanging) {
        leftMap.setCenterZoom(rightMap.getCenter(), rightMap.getZoom());
      }
    }
    function leftSync() {
        if (!rightChanging) {
            leftChanging = true;
            syncMaps();
            leftChanging = false;
        }
    }
    function rightSync() {
        if (!leftChanging) {
            rightChanging = true;
            syncMaps();
            rightChanging = false;
        }
    }

    leftMap.addCallback('panned', leftSync);
    leftMap.addCallback('zoomed', leftSync);
    leftMap.addCallback('extentset', leftSync);
    leftMap.addCallback('centered', leftSync);
    leftMap.addCallback('resized', leftSync);
    rightMap.addCallback('panned', rightSync);
    rightMap.addCallback('zoomed', rightSync);
    rightMap.addCallback('extentset', rightSync);
    rightMap.addCallback('centered', rightSync);
    rightMap.addCallback('resized', rightSync);

    window.onresize = function() {
        leftMap.setSize(container.offsetWidth/2, container.offsetHeight);
        rightMap.setSize(container.offsetWidth/2, container.offsetHeight);
        rightMap.parent.style.left = parseInt(container.offsetWidth/2) + 'px';
    };
}

</script>
</head>
<body onload="initMaps()">
<h1>Modest Maps JS</h1>
<p><a href="javascript:leftMap.zoomIn()">zoom in</a> | <a href="javascript:leftMap.zoomOut()">zoom out</a>
<br><a href="javascript:leftMap.panLeft()">pan left</a> | <a href="javascript:leftMap.panRight()">pan right</a> | <a href="javascript:leftMap.panDown()">pan down</a> | <a href="javascript:leftMap.panUp()">pan up</a></p>
<div id="container" style="width: 100%; height: 500px; position: relative;">
  <div id="leftMap"></div>
  <div id="rightMap"></div>
</div>
</body>
</html>
